# Rulesets Configuration Guide

Comprehensive guide to configuring Rulesets for your project, team, and deployment needs.

## Configuration Hierarchy

Rulesets uses a layered configuration approach with increasing precedence:

1. **Global Config** (`~/.config/ruleset/config.yaml`) - System-wide defaults
2. **Project Config** (`.ruleset/config.yaml`) - Project-specific settings
3. **Rule Front Matter** - Per-rule overrides
4. **CLI Flags** - Command-line overrides

## Global Configuration

Global configuration applies to all Rulesets projects on your system.

### Location

- **Linux/macOS**: `~/.config/ruleset/config.yaml`
- **macOS (alternative)**: `~/Library/Application Support/ruleset/config.yaml`
- **Windows**: `%APPDATA%\ruleset\config.yaml`

### Global Config Example

```yaml
# ~/.config/ruleset/config.yaml
version: '0.2.0'

# Default settings for all projects
rule:
  template: false         # Disable templating by default
  globs: ['**/*.md'] # Only process .md files

# Default provider settings
cursor:
  enabled: true
  priority: medium

windsurf:
  enabled: false          # Disable by default

claude-code:
  enabled: true

# Global partials directory
paths:
  partials: '~/.config/ruleset/partials'

# Logging configuration
log:
  level: info
  format: pretty
```

## Project Configuration

Project configuration is stored in `.ruleset/config.yaml` and applies to the specific project.

### Basic Configuration

```yaml
# .ruleset/config.yaml
version: '0.2.0'

# Source directories (relative to project root)
sources:
  - '.ruleset/rules'
  - 'docs/rules'
  - 'teams/*/rules'       # Glob patterns supported

# Output directory
output: '.ruleset/dist'

# Project-wide rule defaults
rule:
  template: true          # Enable templating by default
  version: '0.2.0'        # Default rule format version

# Provider configuration
cursor:
  enabled: true
  priority: high

windsurf:
  enabled: true
  format: markdown

claude-code:
  enabled: true
  outputPath: 'CLAUDE.md'

agents-md:
  enabled: true
  outputPath: 'AGENTS.md'
```

### Advanced Configuration

```yaml
version: '0.2.0'

# Multiple source configurations
sources:
  - path: '.ruleset/rules'
    globs: ['**/*.md']
    template: true
  - path: 'docs/ai-rules'
    globs: ['*.md', '*.mdc']
    template: false
  - path: 'teams/*/rules'
    globs: ['**/*.md']
    template: true

# Custom output structure
output: '.generated/rules'

# Path overrides
paths:
  partials: '.ruleset/partials'
  templates: '.ruleset/templates'
  cache: '.ruleset/.cache'

# Default rule configuration
rule:
  template: true
  version: '0.2.0'
  globs: ['**/*.ts', '**/*.js']
  handlebars:
    strict: true
    noEscape: false

# Provider-specific defaults
cursor:
  enabled: true
  priority: high
  outputPath: '.cursor/rules'
  handlebars:
    strict: true
    partials:
      footer: 'Generated by Rulesets'

windsurf:
  enabled: true
  format: xml
  outputPath: '.windsurf/rules'

claude-code:
  enabled: true
  outputPath: 'CLAUDE.md'
  section: 'project-rules'

agents-md:
  enabled: true
  outputPath: 'AGENTS.md'
  providers: ['cursor', 'claude-code'] # Which providers to aggregate

# Custom provider configuration
custom-provider:
  enabled: false
  endpoint: 'https://api.example.com/rules'
  apiKey: '${CUSTOM_PROVIDER_KEY}' # Environment variable

# Build configuration
build:
  parallel: true          # Compile providers in parallel
  maxConcurrency: 4       # Limit concurrent compilations
  cache: true             # Enable compilation caching

# Linting configuration
lint:
  strict: true            # Strict linting mode
  rules:
    requireH1: true       # Require H1 heading
    requireDescription: false
    maxFileSize: '5MB'    # Maximum rule file size

# Logging configuration
log:
  level: info             # debug, info, warn, error
  format: json            # pretty, json
  file: '.ruleset/logs/compile.log'
```

## Format Support

Rulesets supports multiple configuration formats:

### YAML (Recommended)

```yaml
# .ruleset/config.yaml
version: '0.2.0'
sources: ['.ruleset/rules']
cursor:
  enabled: true
```

### JSON

```json
// .ruleset/config.json
{
  "version": "0.2.0",
  "sources": [".ruleset/rules"],
  "cursor": {
    "enabled": true
  }
}
```

### JSONC (JSON with Comments)

```jsonc
// .ruleset/config.jsonc
{
  "version": "0.2.0",
  // Source directories
  "sources": [".ruleset/rules"],
  "cursor": {
    "enabled": true
  }
}
```

### TOML

```toml
# .ruleset/config.toml
version = "0.2.0"
sources = [".ruleset/rules"]

[cursor]
enabled = true
```

## Provider Configuration

Each provider can be configured individually with both global defaults and per-rule overrides.

### Cursor Provider

```yaml
cursor:
  enabled: true
  priority: high | medium | low
  outputPath: string                    # Custom output directory
  handlebars:
    force: boolean                      # Override safety restrictions
    strict: boolean                     # Strict mode (default: true)
    noEscape: boolean                   # Disable HTML escaping
    partials: Record<string, string>    # Inline partials
```

**Example:**
```yaml
cursor:
  enabled: true
  priority: high
  outputPath: '.cursor/rules'
  handlebars:
    strict: true
    partials:
      disclaimer: 'This rule is automatically generated.'
      version: 'v{{rule.version}} ({{date}})'
```

### Windsurf Provider

```yaml
windsurf:
  enabled: boolean
  format: markdown | xml               # Output format
  outputPath: string
  handlebars: { ... }                  # Same as other providers
```

### Claude Code Provider

```yaml
claude-code:
  enabled: boolean
  outputPath: string                   # Default: 'CLAUDE.md'
  section: string                      # Section name within output file
  handlebars: { ... }
```

### AGENTS.md Provider

```yaml
agents-md:
  enabled: boolean
  outputPath: string                   # Default: 'AGENTS.md'
  providers: string[]                  # Which providers to aggregate
  handlebars: { ... }
```

### Custom Providers

```yaml
custom-provider:
  enabled: boolean
  # Provider-specific configuration
  endpoint: string
  apiKey: string
  timeout: number
  headers: Record<string, string>
```

## Handlebars Configuration

When templating is enabled, you can configure Handlebars behavior globally and per-provider.

### Global Handlebars Config

```yaml
rule:
  template: true
  handlebars:
    strict: true          # Throw on undefined variables
    noEscape: false       # HTML escape output
    helpers: string[]     # Custom helper modules to load
    partials:             # Global inline partials
      footer: 'Generated on {{date}}'
      header: |
        # {{rule.name}}
        {{rule.description}}
```

### Provider Handlebars Overrides

```yaml
cursor:
  handlebars:
    force: true           # Override global safety settings
    strict: false         # Allow undefined variables
    noEscape: true        # Disable HTML escaping
    partials:
      cursor-footer: 'Cursor-specific footer'
```

### Custom Helpers

```yaml
rule:
  handlebars:
    helpers:
      - './lib/custom-helpers.js'
      - '@company/ruleset-helpers'
```

Example helper file (`./lib/custom-helpers.js`):
```javascript
module.exports = {
  uppercase: (str) => str.toUpperCase(),
  formatDate: (date) => new Date(date).toISOString(),
  projectName: () => process.env.PROJECT_NAME || 'Unknown Project'
};
```

## Path Configuration

Customize directory locations and file patterns.

```yaml
paths:
  source: '.ruleset/rules'      # Default source directory
  output: '.ruleset/dist'       # Default output directory
  partials: '.ruleset/partials' # Partials directory
  cache: '.ruleset/.cache'      # Compilation cache

# Multi-source configuration
sources:
  - path: '.ruleset/rules'
    globs: ['**/*.md']
  - path: 'docs/rules'
    globs: ['*.md']
    exclude: ['README.md']
  - path: 'teams/*/ai-rules'
    globs: ['**/*.md']
    recursive: true
```

## Environment Variables

Configuration values can reference environment variables:

```yaml
# .ruleset/config.yaml
cursor:
  outputPath: '${CURSOR_RULES_PATH:-.cursor/rules}'  # Default if not set

custom-provider:
  apiKey: '${API_KEY}'        # Required environment variable
  endpoint: '${API_ENDPOINT}' # Required environment variable

log:
  level: '${LOG_LEVEL:-info}' # Default to 'info'
```

Set environment variables:
```bash
export CURSOR_RULES_PATH=~/custom-cursor-rules
export API_KEY=your-api-key-here
export LOG_LEVEL=debug
```

## Compilation Options

Control how rules are compiled and processed.

```yaml
build:
  # Performance options
  parallel: true            # Compile providers in parallel
  maxConcurrency: 4         # Limit concurrent compilations
  cache: true               # Enable compilation caching
  cacheDir: '.ruleset/.cache'

  # Processing options
  strict: true              # Strict compilation mode
  failFast: false           # Continue on individual rule failures
  dryRun: false             # Show what would be compiled

  # Output options
  clean: true               # Clean output directory before compile
  timestamp: true           # Add timestamps to compiled files
  metadata: true            # Include metadata in outputs
```

## Linting Configuration

Configure built-in rule validation and linting.

```yaml
lint:
  enabled: true
  strict: false             # Treat warnings as errors

  rules:
    # Content validation
    requireH1: true         # Require H1 heading in content
    requireDescription: false # Require description in front matter
    requireVersion: true    # Require rule.version

    # Format validation
    maxFileSize: '5MB'      # Maximum file size
    maxLineLength: 120      # Maximum line length

    # Template validation
    validateHandlebars: true # Validate Handlebars syntax
    requireTemplate: false   # Require rule.template when using {{}}

    # Provider validation
    validateProviders: true  # Check provider configurations

  # Custom lint rules (if supported)
  custom:
    - './lib/custom-lint-rules.js'
```

## Deployment Configuration

Settings for different deployment environments.

### Development

```yaml
# .ruleset/config.dev.yaml
log:
  level: debug
  format: pretty

build:
  cache: false
  strict: false

lint:
  strict: false
```

### Production

```yaml
# .ruleset/config.prod.yaml
log:
  level: warn
  format: json
  file: '/var/log/rulesets.log'

build:
  cache: true
  strict: true
  failFast: true

lint:
  strict: true
```

### CI/CD

```yaml
# .ruleset/config.ci.yaml
log:
  level: info
  format: json

build:
  parallel: true
  maxConcurrency: 2       # Conservative for CI
  cache: true

lint:
  strict: true            # Fail builds on lint errors
```

Use environment-specific configs:
```bash
# Development
RULESETS_CONFIG=.ruleset/config.dev.yaml rulesets compile

# Production
RULESETS_CONFIG=.ruleset/config.prod.yaml rulesets compile

# CI/CD
RULESETS_CONFIG=.ruleset/config.ci.yaml rulesets compile
```

## Team Configuration

Configure Rulesets for team collaboration and consistency.

### Shared Team Config

```yaml
# .ruleset/config.yaml (committed to repository)
version: '0.2.0'

# Enforce consistent formatting
rule:
  template: true
  version: '0.2.0'

# Standard provider setup
cursor:
  enabled: true
  priority: high

claude-code:
  enabled: true

# Consistent output paths
paths:
  output: '.generated/rules'

# Team linting standards
lint:
  strict: true
  rules:
    requireH1: true
    requireDescription: true
    maxFileSize: '1MB'
```

### Personal Overrides

```yaml
# ~/.config/ruleset/config.yaml (personal settings)
log:
  level: debug            # Personal preference

# Personal provider preferences
windsurf:
  enabled: true           # Enable for personal use

# Personal output locations
cursor:
  outputPath: '~/custom-cursor-rules'
```

## Migration and Compatibility

### Migrating from v0.1.x

```yaml
# Legacy configuration (v0.1.x)
version: '0.1.0'
mixdown:                  # Old namespace
  version: '0.1.0'

destinations:             # Old provider config
  include: ['cursor']

cursor:
  outputPath: '.cursor/rules/mixdown/'
```

Update to v0.2.0:
```yaml
# Modern configuration (v0.2.0)
version: '0.2.0'
rule:                     # New namespace
  version: '0.2.0'

cursor:                   # Direct provider config
  enabled: true
  outputPath: '.cursor/rules/'
```

### Backward Compatibility

Rulesets v0.2.0 maintains backward compatibility:
- Old `mixdown`/`rulesets` namespaces are supported
- Migration warnings help identify needed updates

## Troubleshooting

### Common Configuration Issues

**Config file not found:**
- Check file location: `.ruleset/config.yaml`
- Verify file extension matches format
- Ensure proper YAML syntax

**Rules not discovered:**
- Check `sources` configuration
- Verify files have `rule:` front matter
- Review `globs` patterns

**Provider not working:**
- Confirm provider is `enabled: true`
- Check output path permissions
- Verify provider-specific settings

**Template errors:**
- Enable templating: `rule.template: true`
- Check Handlebars syntax
- Verify partial file locations

### Configuration Validation

Validate your configuration:
```bash
# Check configuration syntax
rulesets compile --dry-run

# Verbose output for debugging
rulesets compile --verbose

# Structured JSON logging (alias: --json)
rulesets compile --format json

# List discovered configuration
rulesets list --config
```

### Debug Configuration

Enable debug logging:
```yaml
log:
  level: debug
  format: pretty
```

Or via environment:
```bash
DEBUG=rulesets:* rulesets compile
```

---

For more examples and advanced configurations, see the [GitHub repository](https://github.com/outfitter-dev/rulesets) and [community discussions](https://github.com/outfitter-dev/rulesets/discussions).
